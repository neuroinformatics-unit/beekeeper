[![License](https://img.shields.io/badge/License-BSD_3--Clause-orange.svg)](https://opensource.org/licenses/BSD-3-Clause)
![CI](https://img.shields.io/github/actions/workflow/status/SainsburyWellcomeCentre/beekeeper/test_and_deploy.yml?label=CI)
[![codecov](https://codecov.io/gh/SainsburyWellcomeCentre/beekeeper/branch/main/graph/badge.svg?token=DYQB8EHTJB)](https://codecov.io/gh/SainsburyWellcomeCentre/beekeeper)
[![Ruff](https://img.shields.io/endpoint?url=https://raw.githubusercontent.com/charliermarsh/ruff/main/assets/badge/v0.json)](https://github.com/charliermarsh/ruff)
[![Code style: black](https://img.shields.io/badge/code%20style-black-000000.svg)](https://github.com/python/black)
[![pre-commit](https://img.shields.io/badge/pre--commit-enabled-brightgreen?logo=pre-commit&logoColor=white)](https://github.com/pre-commit/pre-commit)

# beekeeper üêù
Managing video metadata for animal behaviour experiments.

## Overview

beekeeper is a web-based dashboard built with [Dash-Plotly](https://dash.plotly.com/) for managing video metadata in animal behaviour experiments. It provides an intuitive interface for creating, editing, and organizing metadata files associated with experimental videos.

**Key Features:**
- Upload and manage project configurations
- Interactive metadata table with editing capabilities
- Bulk import from spreadsheets (CSV/Excel)
- Automatic detection of videos missing metadata
- Export metadata as YAML files
- Responsive web interface with Bootstrap theming

It is based on an earlier codebase called [WAZP](https://sainsburywellcomecentre.github.io/WAZP/), but focuses specifically on metadata management.

## Installation

We recommend you install `beekeeper` inside a [conda](https://docs.conda.io/en/latest/) environment.
Once you have `conda` installed, the following will create and activate an environment. You can call your environment whatever you like, we've used `beekeeper-env`.

```sh
conda create -n beekeeper-env -c conda-forge python=3.12
conda activate beekeeper-env
```

Next install the latest version of `beekeeper` from pip:

```sh
git clone https://github.com/sfmig/beekeeper.git
cd beekeeper
pip install .
```

## Quick Start

### 1. Launch the Application
```sh
start-beekeeper
```
This will launch a local web server at `http://localhost:8050/`.

### 2. Upload Project Configuration
- Navigate to the **Home** page
- Upload your `project_config.yaml` file containing:
  ```yaml
  videos_dir_path: /path/to/your/videos
  metadata_fields_file_path: /path/to/metadata_fields.yaml
  metadata_key_field_str: File
  ```

### 3. Manage Metadata
- Go to the **Metadata** page to view/edit your video metadata table
- Use the buttons to add missing videos, import from spreadsheets, or export YAML files

## User Workflow

*Generated by Claude*

### Getting Started
1. **Launch the application**
   ```bash
   start-beekeeper
   ```
   The app opens in your browser at `http://localhost:8050`

2. **Upload Project Configuration**
   - Navigate to the **Home** page (default landing page)
   - Drag and drop or select your `project_config.yaml` file
   - The file should contain:
     ```yaml
     videos_dir_path: /path/to/your/videos
     metadata_fields_file_path: /path/to/metadata_fields.yaml
     metadata_key_field_str: File
     ```
   - You'll see a success message confirming the config was processed

3. **Manage Video Metadata**
   - Navigate to the **Metadata** page
   - The app displays a table with all existing metadata from `.metadata.yaml` files in your videos directory
   - Each row represents one video file's metadata

### Core Operations

#### **Viewing and Editing Metadata**
- **Browse**: Scroll through the paginated table (25 rows per page)
- **Sort**: Click column headers to sort data
- **Hide/Show columns**: Use column visibility controls
- **Edit**: Click any editable cell to modify values directly
- **Row selection**: Click checkboxes to select rows for batch operations

#### **Adding Missing Videos**
- Click **"Check for missing metadata files"**
- The app scans your videos directory and adds rows for videos without `.metadata.yaml` files
- File extensions supported: `.avi`, `.mp4`

#### **Manual Data Entry**
- Click **"Add empty row"** to create a new metadata entry
- Fill in the fields as needed
- The filename field links to your video file

#### **Batch Operations**
- **Select All/Unselect All**: Mass row selection controls
- **Export Selected**: Click "Export selected rows as yaml" to save `.metadata.yaml` files for selected videos
- **Import from Spreadsheet**: Upload CSV/Excel files to bulk generate metadata files

#### **Spreadsheet Import Process**
1. Prepare your spreadsheet (CSV or Excel) with columns matching your metadata fields
2. Click **"Generate yaml files from spreadsheet"**
3. Upload your file
4. The app will:
   - Match spreadsheet columns to metadata fields
   - Add missing columns with empty values
   - Only process rows with corresponding video files
   - Generate `.metadata.yaml` files in your videos directory
   - Show confirmation with count of files generated

## License

‚öñÔ∏è [BSD 3-Clause](https://opensource.org/licenses/BSD-3-Clause)
